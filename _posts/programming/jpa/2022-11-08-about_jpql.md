---
title: "ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ - ê°œìš” (ì‘ì„±ì¤‘)"
categories: 
    - jpa
date: 2022-11-08
last_modified_at: 2022-11-08
# tags:
#     - íƒœê·¸1
#     - íƒœê·¸2
#     - tag_test..
toc: true
toc_sticky: true
# toc_label: "MYSELF"
excerpt: "ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ì— ëŒ€í•œ ì†Œê°œ"
---

JPAëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë‹¤ì–‘í•œ ì¿¼ë¦¬ ë°©ë²•ì„ ì§€ì›í•œë‹¤.

- JPQL
  - JPAì˜ ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ë¡œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ì—”í‹°í‹°ì— ëŒ€í•œ ì¿¼ë¦¬ë¥¼ ë§Œë“œëŠ”ë° ì‚¬ìš©ëœë‹¤.
- JPA Criteria
  - JPQLì„ ìë°” ì½”ë“œë¡œ ì‘ì„±í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” ë¹Œë” í´ë˜ìŠ¤ API
- QueryDSL
  - JPA Criteriaì™€ ë§ˆì°¬ê°€ì§€ë¡œ JPQLì„ ìë°” ì½”ë“œë¡œ ì‘ì„±í• ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬
- Native SQL
  - ë°ì´í„°ë² ì´ìŠ¤ í‘œì¤€ ë¬¸ë²•ì—ì„œ ë²—ì–´ë‚œ ì¢…ì†ì ì¸ ì¿¼ë¦¬ê°€ í•„ìš”í•  ë•Œ ì‚¬ìš©
  - ì˜ˆ) Oracleì˜ connect by, partition by ë“±
- JDBC API, MyBatis, SpringJdbcTemplate,..

ìš°ë¦¬ëŠ” ê·¸ì¤‘ JPQLì„ ì•Œì•„ë³´ì.

## JPQL ì†Œê°œ

ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ëŠ” ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ë‹¤ìŒê³¼ ê°™ì´ ì¡°ê±´ì´ ì—†ëŠ”, ê°€ì¥ ë‹¨ìˆœí•œ ë°©ë²•ì„ ì‚¬ìš©í–ˆë‹¤.

- ì—”í‹°í‹°ë§¤ë‹ˆì € í™œìš©
  - `entityManager.find()`
- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰
  - `entity.getA().getB()`

ê·¸ë ‡ë‹¤ë©´ `ë‚˜ì´ê°€ 18ì‚´ ì´ìƒ`ì¸ íšŒì›ì„ ëª¨ë‘ ê²€ìƒ‰ê³¼ ê°™ì€ ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰í•  ë•ŒëŠ” ì–´ë–»ê²Œ í•´ì•¼ë ê¹Œ?

ë°ì´í„°ì–‘ì´ ë§ì„ ê²½ìš° ìœ„ì˜ ë‘ê°€ì§€ ë°©ì‹ë§Œìœ¼ë¡œëŠ” í•œê³„ê°€ ìˆì„ ê²ƒì´ë‹¤.

JPAë¥¼ ì‚¬ìš©í•˜ë©´ ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œí•´ì•¼ í•œë‹¤. (í…Œì´ë¸”ì€ ë§¤í•‘ë§Œ í•  ë¿ì´ë‹¤.)

ê²€ìƒ‰ì„ í• ë•Œë„ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰ì„ í•´ì•¼í•œë‹¤. ê·¸ëŸ¬ë‚˜ ëª¨ë“  DB ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë³€í™˜í•´ì„œ ê²€ìƒ‰í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— **DBë¡œë¶€í„° í•„ìš”í•œ ë°ì´í„°ë§Œì„ ê°€ì ¸ì˜¤ë ¤ë©´ ê²€ìƒ‰ì¡°ê±´ì´ í¬í•¨ëœ SQLì´ í•„ìš”**í•˜ë‹¤.
(ëª¨ë“  DB ë°ì´í„°ë¥¼ ë“¤ê³ ì˜¤ê²Œë˜ë©´ ê³¼ë„í•œ ë„¤íŠ¸ì›Œí¬ ë¹„ìš© ë° í¼í¬ë¨¼ìŠ¤ ì´ìŠˆê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸)

ê·¸ë˜ì„œ JPAëŠ” **SQLì„ ì¶”ìƒí™”í•œ JPQLì´ë¼ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ë¥¼ ì œê³µ**í•œë‹¤.

JPQLì€ ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ì§€ë‹Œë‹¤.

- SQL ë¬¸ë²•ê³¼ ìœ ì‚¬í•˜ë©° ANSI í‘œì¤€ ë¬¸ë²•ì¸ `SELECT`, `FROM`, `WHERE`, `GROUP BY`, `HAVING`, `JOIN`ì„ ì§€ì›í•œë‹¤.
- í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ì´ë‹¤.
  - SQLì„ ì¶”ìƒí™”í•˜ê¸° ë•Œë¬¸ì— íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
  - ë°ì´í„°ë² ì´ìŠ¤ì— ë§ëŠ” SQL ë¬¸ë²•ìœ¼ë¡œ ë²ˆì—­ì´ ë˜ì–´ ì‹¤ì œ í…Œì´ë¸”ì— ì ìš©ëœë‹¤.


## JPQL ì‚¬ìš©ë°©ë²•

ì‚¬ìš© ë°©ë²•ì€ ê°„ë‹¨í•˜ë‹¤. ë‹¤ìŒê³¼ ê°™ì´ `entityManager`ê°€ ì œê³µí•˜ëŠ” `createQuery`ì™€ `createNativeQuery`ë¥¼ ì‚¬ìš©í•œë‹¤.

### entityManager.createQuery()

`createQuery()`ëŠ” ì—”í‹°í‹°ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤.

jpqlë¬¸ì„ ì‘ì„±í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê·œì¹™ì´ ìˆë‹¤.

- ì—”í‹°í‹°ì™€ ì—”í‹°í‹°ì˜ ì†ì„±ì€ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•œë‹¤.
- `SELECT`, `FROM`, `JOIN` ì™€ ê°™ì€ JPQL í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤.
- alias(ë³„ì¹­)ì€ í•„ìˆ˜ë¡œ ì‘ì„±í•´ì•¼ í•˜ê³  asëŠ” ìƒëµ ê°€ëŠ¥í•˜ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ì´ë¦„ì´ í™ê¸¸ë™ì´ë©° ë‚˜ì´ëŠ” 18ì‚´ ì´ìƒì¸ Member ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•œë‹¤.

`select m from Member m where m.name='í™ê¸¸ë™' and m.age >= 18`



Memberë¼ëŠ” Entityê°€ ìˆë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ ì•„ë˜ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```java
@Entity
public class Member {
  @Id
  @GeneratedValue
  private Long id;

  private String name;

  ...
}

...


// Member ì—”í‹°í‹°ë¥¼ ëŒ€ìƒìœ¼ë¡œ jpqlë¬¸ì„ ì‘ì„±í•œë‹¤. 
String jpql = "select m from Member m where m.name like 'kim%'";

//createQueryì˜ ì²«ë²ˆì¨° ì¸ìëŠ” jpql ë¬¸ìì—´ì´ ë“¤ì–´ê°€ê³  ë‘ë²ˆì§¸ ì¸ìëŠ” ëŒ€ìƒ ì—”í‹°í‹° í´ë˜ìŠ¤ ê°ì²´ë¥¼ ë„£ì–´ì¤€ë‹¤.
List<Member> result = entityManager.createQuery(jpql, Member.class).getResultList();
```



### entityManager.createNativeQuery()

## Criteria ì†Œê°œ

JPQLì˜ ê²½ìš° ì¿¼ë¦¬ë¥¼ ë¬¸ìì—´ë¡œ ì‘ì„±í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ë™ì ìœ¼ë¡œ ì‘ì„±í•˜ë ¤ë©´ ë¬¸ìì—´ì„ ìë¥´ê³  ë¶™ì´ëŠ” ì‘ì—…ì´ ë™ë°˜ë˜ì–´ ë§¤ìš° ì§€ì €ë¶„í•´ì§€ê³  ë³µì¡í•´ì§„ë‹¤. 

jpql ë™ì ì¿¼ë¦¬ ì˜ˆ) 

```java
String jpql = "select m from Member m";

if(username != null){
  String where = " where m.name = '" + username + "'"; // aliasì™€ where ì ˆì„ ë–¨ì–´ëœ¨ë ¤ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì•ë¶€ë¶„ ê³µë°±ë„ ì‹ ê²½ì¨ì•¼í•œë‹¤.
  jpql += where; 
}

List<Member> result = entityManager.createQuery(jpql, Member.class).getResultList();

```

ì´ëŸ¬í•œ ë‹¨ì ì„ ë³´ì™„í•˜ê¸° ìœ„í•´ Criteriaê°€ ë“±ì¥í–ˆë‹¤. 

CriteriaëŠ” ë™ì  ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•œ ë©”ì„œë“œë¥¼ ì œê³µí•´ì£¼ê³  ë¬¸ìì—´ì´ ì•„ë‹Œ ìë°” ì½”ë“œë¡œ ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ ì‹œì ì— ë¯¸ë¦¬ ì˜¤ë¥˜ë¥¼ ì¡ì•„ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì„ ì§€ë‹Œë‹¤.

ê·¸ëŸ¬ë‚˜ ìë°”ì½”ë“œë¡œ ì‘ì„±ë˜ê¸° ë•Œë¬¸ì— SQLë¬¸ê³¼ ë‹¤ë¥´ê³  

## ğŸ“£ Reference
ë³¸ í¬ìŠ¤íŒ…ì€ ê¹€ì˜í•œë‹˜ì˜ ê°•ì˜ë¥¼ ë“£ê³  ìŠ¤ìŠ¤ë¡œ ì •ë¦¬ ë° ì¶”ê°€í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

[ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° - ê¸°ë³¸í¸](https://www.inflearn.com/course/ORM-JPA-Basic/dashboard)<br/>
